@{
    ViewData["Title"] = "Index";
}
@{
    ViewBag.Title = "Details";
}
@using irrigation_system_webapp.Models;

    <script src=
"https://code.jquery.com/jquery-3.6.0.min.js">
    </script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<canvas id="line-chart" width="800" height="450"></canvas>

<script>
    var chartElem = document.getElementById("line-chart");
    var lastTemperatureId = 0;
    var myChart = new Chart(chartElem, {
      type: 'line',
      data: {
        labels: ["a","b"],
        datasets: [{ 
            data: [200,100],
            label: "Africa",
            borderColor: "#3e95cd",
            fill: false
          }
        ]
      },
      options: {
        title: {
          display: true,
          text: 'World population per region (in millions)'
        }
      }
    });

    function initialAjaxCall() {
        $.ajax({
            url: 
            'https://localhost:7213/api/Temperatures',
            type: "GET",
            success: function (data) {
                lastTemperatureId = data[data.length - 1].temperatureId;
            },
            error: function (error) {
                console.log(`Error ${error}`);
            }
        });
    }
    function updateChartAjaxCall() {
        $.ajax({
            url: 
            'https://localhost:7213/api/Temperatures/Last',
            type: "GET",
            success: function (data) {
                console.log("last =", lastTemperatureId);
                console.log("current", data.temperatureId);
                console.log("current complete", data);
                console.log("");
                if (data.temperatureId > lastTemperatureId) {
                    lastTemperatureId = data.temperatureId;
                    addData(myChart, data.date.toString(), data.value);
                }
            },
            error: function (error) {
                console.log(`Error ${error}`);
            }
        });
    }
    initialAjaxCall();
    
    setInterval(function(){
        updateChartAjaxCall() 
        //num += 100;
        //addData(myChart,"label",num);
    }, 1000);
var num = 100;

function addData(chart, label, data) {
    chart.data.labels.push(label);
    chart.data.datasets.forEach((dataset) => {
        dataset.data.push(data);
    });
    chart.update();
}


</script>